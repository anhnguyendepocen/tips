---
title: "John's AZtec Tips"
author: "J. R. Minter"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Oxford AZtec Tips}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

This documents contains hints that I find helpful when using the Oxford AZtec 2.2 Software.

[Back to Index](../README.html)

### Exporting maps and making montages

I like tightly-stitched maps with the ability to crop regions of interest. Here is the current procedure I use. The export of the PNG files is kludgy - I need to try to write an Auto-IT to script. This keeps the raw images in the ``$EDS_ROOT/Oxford/QM14-nn-nnA-Client/reports/qm-nnnnn-sampleID/qm-nnnnn-sampleID-nnkV-map1/tif`` tree where I cannot use version control (AZtec projects fail to open...) and the python scripts and report images in the ``$HOME/work/proj/QM14-nn-nnA-Client/`` tree where I do use version control (``git``). **Note:** the scripts below use functions from ``jmFijiGen.py`` which must be in ``$FIJI_ROOT/jars/Lib/``.

1. **Set the maps to have consistent colors**. I have some suggestions below. This is most easily accomplished from the ``Summary View``. One may export these as '.png' files but the brightness/contrast/gain mapping are done with point and click. It is better to record a lists of names, hue values, and gammas for the newer scripts. An example is shown below. **Note:** the -1 value for hue is a flag not to run the LUT change routine.

```
lName   = ["N-K","O-K","Cu-L", "P-K", "Na-K","Cl-K", "Pd-L", "Ag-L", "ROI"]
lHue    = [    0,  120,   180,   150,   210,    90,     60,     30 , -1   ]
lGamma  = [  1.0,  1.0,   1.0,   1.0,   1.0,   1.0,    1.0,    1.0 , 1.0  ]

```

2. **Record the full width of the ROI**. From the ``Interactive View``, select a map, right click and select ``Details``. Record the ``Resolution (Width)`` (px) and ``Image (width)`` (typically $\mu m$). For maps processed with the new ImageJ scripts, one wants this type of detail for the scripts

```
#        sz   w-px  um
lCal = [116., 1024, -6]
```

3. **Export images of the maps**.  Note the **Preferred way:** Export ``Data Only`` from the ``Data Tree`` as  **TIF** files. This is preferred because one gets 16 bit data and can map it with a script and it minimizes directory changes. Sometimes if you used a ROI during acquisition, the microscope image is not exactly the same size as the others. You may have to use the GUI (as shown below) for that image. In this case you will un-click the keep aspect ratio box and enter the desired values. You can also have AZtec draw the ROIs for desired extracted spectra. 

![Export-Settings](img/Export-Settings.png)

Note that following the convention for folders (``$EDS_ROOT/Oxford/QM14-nn-nnA-Client/reports/qm-nnnnn-sampleID/qm-nnnnn-sampleID-nnkV-map1/tif``) makes it a **lot** easier to configure the scripts.

After you navigate to a folder you created, save the image with a name like ``C-K.tif``, ``Ag-L.tif``, ... Repeat this for all the other maps and the final image of the ROI, like ``ROI.tif``. Note, one might want extracted spectra ROIs on the ROI image. Then you need to use the GUI as noted above.

4. **Create a folder** in ``$HOME/work/proj/QM14-nn-nnA-Client/py/Fiji`` and make a copy of the folder ``$GIT_HOME/OSImageAnalysis/ImageJ/macros/py/maps`` using the name of your map, i.e. ``qm-0nnnn-sampID-nnkV-mapN`` and rename the scripts in the folder to match the sample and the map.

6. **Edit the file paths** to point to your map in the ``$EDS_ROOT`` folder tree and to the project folder in the ``$HOME/work/proj/QM14-nn-nnA-Client/Sweave/inc/png`` tree. These have been tuned with path variables to minimize typing/editing. 

7. **Edit the configuration info from step 2.  Note:** The name list fills from left to right from the top row.


8. **Run the prep script.** Make sure you get the intensity mapping that you want and are pleased with the display. Note the ``bTstPath`` flag. If this is ``True`` it will just print the paths so you know they are right. Note the ``bSave`` flag. Set this to ``False`` to make sure you get the hue and gamma values tuned to best display the information in the map. Then set it to ``True`` to save the images. The script pauses for 2 sec per image so you can see it on the final pass.

9. **Run the montage script** This will give you a calibrated image. This has a ``bTestPaths`` that if set to ``True`` will make sure it can load the ROI image. There is a ``bScale`` flag and a ``scaFac`` variable (often set to 0.5) to let you down-sample the maps with a bi-cubic spline. This makes the montages a bit smaller and gives reasonable averaging to improve S/N. You will get a calibrated map that is saved to the report tree.

10. **Add a scale bar.** Use the ``Cookbook > Annotating Images > Add Scale Bar`` tool.

11. **Annotate the map.** Use the ``Text Tool``. Save the annotated map, ``qm-nnnnn-sampleID-nnkV-mapN-ann.png``, in the ``$HOME/work/proj/QM14-nn-nnA-Client/Sweave/inc/png`` tree. These ``.png`` files may be used with Sweave, RMarkdown, or PowerPoint for reports.

### Preferred colors for maps

It helps to have consistent colors for maps. *N.B.* there are issues with R/G colorblindness here....

<style>
table:nth-of-type(1) {
    display:table;
    width:25%;
}
table:nth-of-type(2) {
    display:table;
    width:30%;
}
</style>

| transition | deg | name             |
|------------|----:|:-----------------|
| C K        | 0   | red              |
| N K        | 210 | azure            |
| O K        | 120 | green            |
| Si K       | 330 | rose             |
| Cu L       | 180 | cyan             |
| P K        | 150 | spring green     |
| K K        | 270 | violet           |
| Pd L       |  60 | yellow           |
| Cl K       |  90 | chartreuse green |
| Pt M       |  90 | chartreuse green |
| Ag L       |  30 | orange           |
| Ga L       | 300 | magenta          |
| S  K       | 300 | magenta          |
| Na K       | 240 | blue             |

**Note** One can easily see and change values from the Summary view. We also don't often have don't often have both Ga and S or Pt and Cl

![Summary View](img/EasySetMapColors.png)


#### HSV Color wheel values

See [Wikipedia](http://simple.wikipedia.org/wiki/Color_wheel)

![RBG color wheel](img/RBG_color_wheel.png)

"RBG color wheel" by DanPMK.

The 12 major colors of the color wheel, at 30 degree intervals on the HSV color wheel (shown above), are the following:



|color            | degrees|
|-----------------|-------:|
|red              |    0   |
|orange           |   30   |
|yellow           |   60   |
|chartreuse green |   90   |
|green            |  120   |
|spring green     |  150   |
|cyan             |  180   |
|azure            |  210   |
|blue             |  240   |
|violet           |  270   |
|magenta          |  300   |
|rose             |  330   |


This constitutes the complete set of primary, secondary, and tertiary color names.

### Report templates

My current favorite report templates are

![FavReportTemplates](img/FavReportTemplates.png)

### EDS Mapping parameters


#### AutoLock

My first reasonable set below...

![AutoLock Set 1](img/GoodAutolock.png)

My most recent reasonable set for a high resolution map below:

![AutoLock Set 2](img/map-3-autolock-settings.png)

One annoying feature of Auto-Lock is that one cannot see the Auto-Lock settings on an offline version. I tend to do a screen print of the AutoLock History in the Mini View

![Autolock History](img/map-3-autolock-meas.png)

and the AutoLock Progression image. Note the substantial drift that was corrected in three and a half hours.

![AutoLock Progression](img/map-3-autolock-progression.png)

On the AZtec system one can crop these using ``Microsoft Paint`` and store them in the ``reports`` folder. Note that this specimen was mounted on a C-coated Formvar support film on a 200 mesh grid in turn mounted on a C adhesive tab. Many microscope engineers warn that drift is bad when these tabs are used.



The best discussion starts on p. 160 of the manual. It might be worth changing my tracking image to size 512 and a dwell time of 10 us. Need to see how that changes the frame time and think about a reasonable interval (they use 10 sec).

#### EDS Mapping for 7 kV

![Mapping](img/GoodMapPar.png)

### Controlling the export of maps
1. For the map you want, right click and select ``Details``.
2. Note the ``Resolution (Width)`` (e.g. 1024 px) and the ``Image Width`` (e.g. 193 $\mu$m). You may want to note the ``Magnification`` as well...
3. Again for the map you want, right click and select ``Export >> Settings``. Leave ``Keep Aspect Ratio``checked and turn off what you don't want. Set to the resolution you want (i.e. 1024) and then press ``Save As...``

## A better proposed strategy for probe current proxy measurements

### The basic idea
 
The ``Optimize`` menu makes it easy to do a beam current measurement. It is important to configure for the correct element and process time to be relevant to our DTSA-II detectors.

![BeamCurrentMeasCfg](img/BeamCurrentMeasCfg.png)

The manual (p. 86) has a discussion of the proper element to use. They like Cr because it polishes well and does not oxidize. The K line isn't sufficiently excited to use below 15 kV.  Cu grids are convenient, but seem to have the same problem if the software wants to use the K line. Silicon chips might make a good option for a wide range of voltages but would be hard to use with my Ted Pella XCS-8 standard Faraday cage.

One gets the required data from the ``Calculate Composition`` tab of ``Point & ID`` and then choosing the ``Spectrum Details`` from the ``Available Templates``:

![AvailableTemplates](img/AvailableTemplates.png)

Si is a good choice for the whole range. I measured the ``cps/nA`` for a range of voltages. See the project ``2014-09-12-Cu-Si`` for the data and more information. 


|e0  | mean    | std dev |
|---:|--------:|--------:|
|  5 |  1825.1 |  39.7   |
|  7 |  3895.1 |  65.1   |
| 10 |  7605.8 | 106.0   |
| 15 | 14052.0 | 170.0   |
| 20 | 20305.2 | 261.3   |
| 30 | 29843.4 | 383.9   |

![AZtec-Si-Beam-Calibration](img/AZtec-Si-Beam-Calibration.png)



Note the ``Beam Calibration Information`` section contains all we need:

![Beam Calibration Information](img/BeamCalibrationInfo.png)

We can copy this information into a text document with a right click.


The Si peak is well-behaved with voltage. This is an analysis using DTSA-II to fit **just the characteristic peaks**. This is easily automated, given the spectra, using a Jython script.

![SiK](img/SiK.png)

|e0  | mean    | std dev |
|---:|--------:|--------:|
|  5 |  1832.4 |  40.3   |
|  7 |  3884.2 |  65.3   |
| 10 |  7573.1 | 105.7   |
| 15 | 13921.0 | 168.2   |
| 20 | 20059.1 | 257.7   |
| 30 | 29362.6 | 377.0   |

The AZtec beam measurement routine only works successfully for Cu above 10 kV (because it always uses the K-line), though one can use DTSA-II approach. The Si spectra are cleaner and have no oxidation. The Cu data are in the project ``2014-09-12-QC``.

## Alchemy...

### Distorted scan

Sometimes when image collection is stopped, the scan is offset and looks odd on the microscope display. The solution is to reset the hardware. Close AZtec and run the tidy-up program to reset everything.

### Setting your own logo

The Oxford logo is in a file ``logo.png`` in ``C:\Program Files\Oxford Instruments NanoAnalysis\AZtec\Reports``. It is ``150x71`` pixels. design a replacement with the same aspect ratio and rename the old one to ``logo-old.png``



## Basic Info

Oxford S/N: ``CZC4081PBM``     
System NO:  ``37404``


### A proposed SPI Standards Block

```
1. Faraday Cup      02750-AB      $611.80
2. Cu               AS4150-AB     $178.60
3. Pd               AS4250-AB     $178.60
4. K496 (P and O)   AS7270-AB     $357.20
5. Si               AS4060-AB     $178.60
6. Co               AS4130-AB     $178.60
7. Rb2SnCl6 (Cl)    AS8230-AB     $178.60
8. Pyrolytic C      AS4030-AB     $178.60
9. Nine Hole Mount  ASTP05009-AB $2379.75
```

### The setup

There is a power strip mounted on the base of the Sirion on the bottom rail. It supplies power to the computer, monitor, the micsF+ box and the x-stream-2 box, as well as a 24 V laptop power supply. The laptop power supply plugs into a cable on the detector and another cable goes to the x-stream2 box.

One can shut the computer down and turn off the strip to turn everything off.

Note: one can use the tidy-up program to reset everything.


## Low-energy and high spatial resolution EDS mapping

A webinar (2015-06-18) by Jens Rafaelsen, an applications engineer at EDAX. He had real tech issues... Did simulations with DTSA-II and Casino. Also uses the radial distributions, also simulating probe size. This would be useful.

Test specimen - flick a lighter flint onto Si. Flint has Ce.

He thinks beam drift at. Drift was manageble. Also said let scope stabilize for an hour before drift correction.






[Back to Index](../README.html)
