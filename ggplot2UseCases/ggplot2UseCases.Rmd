---
title: "The microscopist's use cases for ggplot2"
author: "J. R. Minter"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  knitr:::html_vignette:
    css: ../theme/jm-blue-vignette.css
    number_sections: yes
    toc: yes
---

[Back to Index](../README.html)

See also the **ggplotExamples** project in your private jrm-solutions repo.


First, let's load the packages we need.

```{r}
library(ggplot2)
library(latex2exp)
```


# Plot/fit data from a Monte Carlo simulation of an EDS spectrum

## Load the data

```{r}
fi <-'./dat/csv/C-ctd-Si-5-kV-10000-Traj.csv'
df <- read.csv(fi, header=TRUE, as.is=TRUE)
print(head(df))
```

## Compute the C/Si peak ratio and uncertainty

```{r}
df$c.to.si.mu <- df$C.Int.mu / df$Si.Int.mu
df$c.to.si.unc <- sqrt((df$C.Int.unc/df$C.Int.mu)**2 + 
                       (df$Si.Int.unc/df$Si.Int.mu)**2)
```

## Make our plot

```{r}
ctosiInt <- ggplot(df, aes(x=t.C.nm, y=c.to.si.mu)) + 
    geom_errorbar(aes(ymin=c.to.si.mu - 1.96*c.to.si.unc,
                      ymax=c.to.si.mu + 1.96*c.to.si.unc), width=.1) +
    stat_smooth(method = "loess") +
    annotate("text", label = 'loess smooth',
             x = 70, y = 1.1,
             size = 5, colour = "blue") +
    geom_point(color='black', size=2) +
    xlab("C thickness [nm]") +
    ylab("C-K/Si-K X-ray intensity ratio") +
    ggtitle("Monte Carlo Model of C-coatings on Si at 5 kV") +
    theme(axis.text=element_text(size=12),
          axis.title=element_text(size=14),
          plot.title = element_text(hjust = 0.5)) # center the title

print(ctosiInt)
```

## Compute LOESS interpolated predicted values

```{r}
t.C.nm <- seq(from=0.5, to=100, by=0.5)
df2 <- data.frame(t.C.nm=t.C.nm, c.to.si.mu=t.C.nm)
df2$c.to.si.mu = predict(loess(c.to.si.mu~t.C.nm, data=df2))
```

## Write some output

```{r}

fi <- './dat/pdf/c-ctd-si-series-plt-5kV.pdf'
ggsave(ctosiInt, file=fi, width=9.0, height=6.0, units="in", dpi=300)

fi <- './dat/png/c-ctd-si-series-plt-5kV.png'

# we want the png to be close to 1024x768...
ggsave(ctosiInt, file=fi, width=9.0, height=6.0, units="in", dpi=113.7778)

fi <- './dat/csv/c-ctd-si-loess-pred-5kV.csv'
write.csv(df2, file=fi, row.names=FALSE)

```


# Analyze particle size and shape data

## Step 1

Load the data and decide if we want to save plots

```{r, results='asis'}
grains <- read.csv("./dat/csv/grains.csv", header = TRUE, as.is=TRUE)
print(names(grains))
bSave <- FALSE
```

## Step 2. Making a Histogram With ggplot2

You have two options to make a histogram with ``ggplot2`` package. You can either use the ``qplot()`` function, which looks very much like the ``hist()`` function:

```{r}
pHistoAgxDiam <- ggplot(grains, aes(ecd.nm)) +
  geom_histogram(binwidth = 5) +
  # scale_x_continuous(breaks = seq(from = 7, to = 20, by = 1)) +
  # scale_y_discrete(breaks = c(0, 2, 4, 6, 8, 10, 12, 14, 16)) +
  ggtitle("Grain Equivalent Circular Diameter") +
  theme(plot.title = element_text(lineheight=2, size=12)) +
  # labs(x=TeX("diameter ($\\mu$m)"), y="Count")
  labs(x="diameter (nm)", y="Count") 

if (bSave == TRUE) {
  ggsave("./dat/png/grain-ecd-histo.png", plot=pHistoAgxDiam,
         width=6, height=4, units="in", dpi=150)
}
print(pHistoAgxDiam)
```

## Step 3. Make a histogram for aspect ratio


```{r}
print(summary(grains$a.r))

pHistoAgxAr <- ggplot(grains, aes(a.r)) +
  geom_histogram(bins=50) +  # binwidth = 5) +
  # scale_x_continuous(breaks = seq(from = 7, to = 20, by = 1)) +
  # scale_y_discrete(breaks = c(0, 2, 4, 6, 8, 10, 12, 14, 16)) +
  ggtitle("Grain Aspect Ratio") +
  theme(plot.title = element_text(lineheight=2, size=12)) +
  # labs(x=TeX("diameter ($\\mu$m)"), y="Count")
  labs(x="diameter (nm)", y="Count") 

if (bSave == TRUE) {
  ggsave("./dat/png/grain-ecd-histo.png", plot=pHistoAgxAr,
         width=6, height=4, units="in", dpi=150)
}
print(pHistoAgxAr)
```

## Step 4. Make some classes and plot

```{r}
equiAxial <- grains$ecd.nm[grains$a.r < 1.05]
elongated <- grains$ecd.nm[grains$a.r >= 1.05]
df1 <- data.frame(ecd=equiAxial,shape='equiaxial')
df2 <- data.frame(ecd=elongated,shape='elonganted')
shapes <- rbind(df1,df2)
rm(df1, df2)

pBoxPlotEcdAr <- ggplot(shapes, aes(x=shape, y=ecd)) +
  geom_boxplot(aes(fill = shape)) +
  # scale_y_continuous(breaks = seq(from = 10, to = 20, by = 1)) +
  # ggtitle(TeX("Beads $\\geq 10\\mu$m\n from Class 837 Support")) +
  # theme(plot.title = element_text(lineheight=2, size=12)) +
  labs("equivalent circular diameter (nm)") 

if (bSave == TRUE) {
   ggsave("./dat/png/grain-ecd-shape-boxplot.png",
          plot=pBoxPlotEcdAr, width=6, height=4,
          units="in", dpi=150)
}
print(pBoxPlotEcdAr)
```

## Step 5. Make a scatter plot


```{r}
pScatterAgXArEcd <- ggplot(grains, aes(x=a.r, y=ecd.nm)) +
  geom_point(colour="blue") + 
  # scale_x_continuous(breaks = seq(from = 7, to = 20, by = 1)) +
  # scale_y_discrete(breaks = c(0, 2, 4, 6, 8, 10, 12, 14, 16)) +
  # ggtitle("Grain Aspect Ratio") +
  # theme(plot.title = element_text(lineheight=2, size=12)) +
  # labs(x=TeX("diameter ($\\mu$m)"), y="Count")
  labs(x="aspect ratio", y="ecd [nm]") 
if (bSave == TRUE) {
  ggsave("./dat/png/grain-ecd-ar.png", plot=pScatterAgXArEcd,
         width=6, height=4, units="in", dpi=150)
}
print(pScatterAgXArEcd)
```

```{r}
pScatterAgXCircEcd <- ggplot(grains, aes(x=circ, y=ecd.nm)) +
  geom_point(colour="blue") + 
  # scale_x_continuous(breaks = seq(from = 7, to = 20, by = 1)) +
  # scale_y_discrete(breaks = c(0, 2, 4, 6, 8, 10, 12, 14, 16)) +
  # ggtitle("Grain Aspect Ratio") +
  # theme(plot.title = element_text(lineheight=2, size=12)) +
  # labs(x=TeX("diameter ($\\mu$m)"), y="Count")
  labs(x="circularity", y="ecd [nm]") 
if (bSave == TRUE) {
  ggsave("./dat/png/grain-ecd-circ.png", plot=pScatterAgXCircEcd,
         width=6, height=4, units="in", dpi=150)
}
print(pScatterAgXCircEcd)
```

## Step 5. Plot the diameter distrbution of our dominant morphology

```{r}
dominant <- grains[grains$a.r <= 1.2, ]
dominant <- dominant[dominant$circ >= 0.8, ]

ecd.mu <- mean(dominant$ecd.nm)
ecd.sd <- sd(dominant$ecd.nm)


pDomGrainDiam <- ggplot(dominant, aes(ecd.nm)) +
  geom_histogram(binwidth = 5) +
  # scale_x_continuous(breaks = seq(from = 7, to = 20, by = 1)) +
  # scale_y_discrete(breaks = c(0, 2, 4, 6, 8, 10, 12, 14, 16)) +
  ggtitle("Dominant Population Equivalent Circular Diameter") +
  theme(plot.title = element_text(lineheight=2, size=12)) +
  # labs(x=TeX("diameter ($\\mu$m)"), y="Count")
  labs(x="diameter (nm)", y="Count") 

if (bSave == TRUE) {
 ggsave("./dat/png/dom-grain-ecd-histo.png", plot=pDomGrainDiam,
        width=6, height=4, units="in", dpi=150)
}
print(pDomGrainDiam)
```

## Step 5. Make a plot of computed Gaussian data

```{r}

ecd <- rnorm(100000, mean=ecd.mu, sd=ecd.sd)
df <- data.frame(ecd=ecd)
theoHistPlot <- ggplot(df, aes(ecd)) +
  geom_histogram(binwidth = .1) +
  labs(x="diameter (nm)", y="Count") 

print(theoHistPlot)
  

```


[Back to Index](../README.html)