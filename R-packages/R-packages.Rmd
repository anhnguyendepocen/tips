---
title: "R Package Tips"
author: "J. R. Minter"
date: "Started: 2015-05-08, Last modified: 2018-10-11"
output:
  html_document:
    css: ../theme/jm-gray-vignette.css
    number_sections: yes
    toc: yes
    toc_depth: 3
---

[Back to Index](../README.html)

# Overview

One of the best ways to make analyses reproducible is to not 
repeatedly write the same code. Instead, our goal is to assemble
re-usable functions into R packages under version control and
containing unit tests. This document contains my favorite tips
assembled from various sites on the web.

# Key References

[Jeff Leek's group practices](https://github.com/jtleek/rpackages)     
[Hadley Wikham's site](http://r-pkgs.had.co.nz/)     
[Hadley book on github](https://github.com/hadley/r-pkgs/)     
[CRAN keywords vignette](http://cran.r-project.org/web/packages/roxygen2/vignettes/rdkeywords.html)    
[CRAN roxygen process](http://cran.r-project.org/web/packages/roxygen2/vignettes/rd.html)    

# Key tips

## Yihui Xie: don't use `package.skeleton()`

From [here](http://r.789695.n4.nabble.com/roxygen2-v6-0-0-td4728654.html):

> 2017-02-06    
>    
> If your package source is version controlled (meaning you are free to 
> regret any time), I'd recommend you to delete the three files 
> NAMESPACE, chr.Rd, and essai-package.Rd. Then try to roxygenize again. 
> Basically the warnings you saw indicates that roxygen2 failed to find 
> the line 
> 
> % Generated by roxygen2: do not edit by hand 
> 
> in your NAMESPACE and .Rd files, so it thinks these files were 
> probably not previously generated by roxygen2. I think the cause is 
> package.skeleton(), which generated the Rd files. Seriously, 
> **friends don't let friends use `package.skeleton()`...**
> (it is 2017 now). 
> 
> Regards,     
> Yihui 

## Building a package with Rmarkdown vignettes

1. Run `devtools::build_vignettes()`
2. Restart R
3. Check by running:

```
library(pkgName)
browseVignettes("pkgName")
```

## Issue on Windows

The procedure above worked om mac for rEDS. On my Win 7 box I needed
to do:

```
devtools::install_github("jrminter/rEDS", build_vignettes = TRUE, force = TRUE)
```

There is another way - from the package project:

```
devtools::install(build_vignettes = TRUE)
```

then the commands below worked

```
library(rEDS)
browseVignettes('rEDS')
```




# Set up a new package `myPkg` that we plan to host on github

On my local computer:

```
setwd("~/git/")
library("devtools")
library("roxygen2")
library("knitr")
create("myPkg")
```

Then from the shell:

```
cd ~/git/myPkg
git init
```

Create a new repository on github. Then push my local copy to
github from the shell:

```
git remote add origin git@github.com:jrminter/myPkg.git
git add *
git commit -m 'initial commit'
git push -u origin master
```

# The cursed "no visible binding for global variable" error...

Using LazyLoaded data often gives this error. The key is to explicitly use the variable from the package namespace, eg:

```
ret <- func(myPkg::var, other)
```

# The importance of vignettes

> If you’re thinking without writing, you only think you’re thinking. -- Leslie Lamport

Vignettes are preferred to examples in documentation. These are much less painful to write using `rmarkdown` than `LaTeX`!

To create the first vignette, run:

```
devtools::use_vignette("my-vignette")
```

This will:

1. Create a `vignettes/` directory.
2. Add the necessary dependencies to DESCRIPTION.
3. Draft a vignette, `vignettes/my-vignette.Rmd`.



[Back to Index](../README.html)